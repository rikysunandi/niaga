$(function() {
    "use strict";

    var chart_dapot_daya, chart_dapot_daya_unit, chart_dapot_bp, chart_dapot_bp_unit, chart_jenis, chart_jenis_unit, chart_tmp, chart_tmp_unit, chart_alasan, chart_alasan_unit;

    $('#sel_unit').selectpicker('val', '00');


    $('div#pasang_baru').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensiJenisTransaksi.php?jenis_transaksi=pasang baru', function(data){
        $('#dapot_jenis_transaksi #pasang_baru #jml_agenda').html(data.jml_agenda);
        $('#dapot_jenis_transaksi #pasang_baru #jml_daya').html(data.jml_daya);
        $('#dapot_jenis_transaksi #pasang_baru #jml_rpbp').html(data.jml_rpbp);
        $('#dapot_jenis_transaksi #pasang_baru #jml_rpujl').html(data.jml_rpujl);
        $('div#pasang_baru').unblock();
    });
    $('div#perubahan_daya').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensiJenisTransaksi.php?jenis_transaksi=perubahan daya', function(data){
        $('#dapot_jenis_transaksi #perubahan_daya #jml_agenda').html(data.jml_agenda);
        $('#dapot_jenis_transaksi #perubahan_daya #jml_daya').html(data.jml_daya);
        $('#dapot_jenis_transaksi #perubahan_daya #jml_rpbp').html(data.jml_rpbp);
        $('#dapot_jenis_transaksi #perubahan_daya #jml_rpujl').html(data.jml_rpujl);
        $('div#perubahan_daya').unblock();
    });
    $('div#sambung_kembali').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensiJenisTransaksi.php?jenis_transaksi=sambung kembali', function(data){
        $('#dapot_jenis_transaksi #sambung_kembali #jml_agenda').html(data.jml_agenda);
        $('#dapot_jenis_transaksi #sambung_kembali #jml_daya').html(data.jml_daya);
        $('#dapot_jenis_transaksi #sambung_kembali #jml_rpbp').html(data.jml_rpbp);
        $('#dapot_jenis_transaksi #sambung_kembali #jml_rpujl').html(data.jml_rpujl);
        $('div#sambung_kembali').unblock();
    });

    $('div#non_ge').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensi.php?klp_plg=NON_GE', function(data){
        $('#dapot #non_ge #jml_agenda').html(data.jml_agenda);
        $('#dapot #non_ge #jml_daya').html(data.jml_daya);
        $('#dapot #non_ge #jml_rpbp').html(data.jml_rpbp);
        $('#dapot #non_ge #jml_rpujl').html(data.jml_rpujl);
        $('div#non_ge').unblock();
    });
    $('div#ge').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensi.php?klp_plg=GE', function(data){
        $('#dapot #ge #jml_agenda').html(data.jml_agenda);
        $('#dapot #ge #jml_daya').html(data.jml_daya);
        $('#dapot #ge #jml_rpbp').html(data.jml_rpbp);
        $('#dapot #ge #jml_rpujl').html(data.jml_rpujl);
        $('div#ge').unblock();
    });
    $('div#tm').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensi.php?klp_plg=TM', function(data){
        $('#dapot #tm #jml_agenda').html(data.jml_agenda);
        $('#dapot #tm #jml_daya').html(data.jml_daya);
        $('#dapot #tm #jml_rpbp').html(data.jml_rpbp);
        $('#dapot #tm #jml_rpujl').html(data.jml_rpujl);
        $('div#tm').unblock();
    });

    $('div#dapot_daya').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensiDaya.php', function(data){
        var ctx = document.getElementById("chart_dapot_daya");
        ctx.width = 220;
        ctx.height = 220;
        chart_dapot_daya = new Chart(ctx, {
            type: 'pie',
            data: {
                datasets: [{
                    data: data.jml_daya,
                    backgroundColor: [
                        '#135470',
                        '#74BCC7',
                        '#F2C36B',
                        '#EC5B43',
                        '#7F63F4',
                        '#3D494A',
                        '#9DA6AB',
                    ],
                    label: 'Daya'
                }],
                labels: data.klp_plg
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    arc: {
                        borderWidth: 0
                    }
                },
                legend: {
                    position: 'bottom',
                    display: 0,
                    labels: {
                        // fontFamily: 'CircularStdBook',
                        fontSize: 8,
                    },
                },
                tooltips:{
                    titleFontSize: 8,
                    bodyFontSize: 8,
                    footerFontSize: 8,
                },
                plugins: {
                    labels: [
                        {
                          render: 'label',
                          fontSize: 7,
                          fontColor:  [
                                '#135470',
                                '#74BCC7',
                                '#F2C36B',
                                '#EC5B43',
                                '#7F63F4',
                                '#3D494A',
                                '#9DA6AB',
                            ],
                          precision: 0,
                          position: 'outside',
                          arc: true,
                          textMargin: 2,
                        },
                        {
                          render: 'value',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 1,
                          position: 'border'
                        },
                        {
                          render: 'percentage',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 0,
                          position: 'default'
                        }
                    ]
                },
            }
        });

        $('div#dapot_daya').unblock();

    });

    $('div#dapot_daya_unit').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensiDayaUnit.php', function(data){

        var ctx = document.getElementById("chart_dapot_daya_unit");
        ctx.height = 220;
        chart_dapot_daya_unit = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.singkatan,
                datasets: [
                    {
                        label: "NON GE",
                        type: "bar",
                        backgroundColor: "#135470",
                        backgroundColorHover: "#135470",
                        data: data.jml_daya_non_ge,
                    },
                    {
                        label: "GE",
                        type: "bar",
                        backgroundColor: "#74BCC7",
                        backgroundColorHover: "#74BCC7",
                        data: data.jml_daya_ge,
                    },
                    {
                        label: "TM",
                        type: "bar",
                        backgroundColor: "#F2C36B",
                        backgroundColorHover: "#F2C36B",
                        data: data.jml_daya_tm,
                    },
                ]
            },
            options: {
                responsive: true, 
                maintainAspectRatio: false, 
                barRadius: 2,
                title: {
                    display: false,
                    text: 'Rekap Potensi'
                },
                tooltips: {
                   mode: 'label',
                   bodyFontSize: 10,
                   callbacks: {
                      label: function(t, d) {
                         var dstLabel = d.datasets[t.datasetIndex].label;
                         var yLabel = t.yLabel;
                         return dstLabel + ': ' + yLabel + ' mVA';
                      }
                   }
                },
                legend: {
                    position: 'bottom',
                    display: true,
                    labels: {
                        fontSize: 10,
                    },
                },
                plugins: {
                    labels: []
                },
                scales: {
                    yAxes: [{
                        display: false,
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                    }]
                }
            }
        });

        $('div#dapot_daya_unit').unblock();

    });

    $('div#dapot_bp').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensiBP.php', function(data){
        var ctx = document.getElementById("chart_dapot_bp");
        ctx.width = 220;
        ctx.height = 220;
        chart_dapot_bp = new Chart(ctx, {
            type: 'pie',
            data: {
                datasets: [{
                    data: data.jml_rpbp,
                    backgroundColor: [
                        '#135470',
                        '#74BCC7',
                        '#F2C36B',
                        '#EC5B43',
                        '#7F63F4',
                        '#3D494A',
                        '#9DA6AB',
                    ],
                    label: 'bp'
                }],
                labels: data.klp_plg
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    arc: {
                        borderWidth: 0
                    }
                },
                legend: {
                    position: 'bottom',
                    display: 0,
                    labels: {
                        // fontFamily: 'CircularStdBook',
                        fontSize: 8,
                    },
                },
                tooltips:{
                    titleFontSize: 8,
                    bodyFontSize: 8,
                    footerFontSize: 8,
                },
                plugins: {
                    labels: [
                        {
                          render: 'label',
                          fontSize: 7,
                          fontColor:  [
                                '#135470',
                                '#74BCC7',
                                '#F2C36B',
                                '#EC5B43',
                                '#7F63F4',
                                '#3D494A',
                                '#9DA6AB',
                            ],
                          precision: 0,
                          position: 'outside',
                          arc: true,
                          textMargin: 2,
                        },
                        {
                          render: 'value',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 1,
                          position: 'border'
                        },
                        {
                          render: 'percentage',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 0,
                          position: 'default'
                        }
                    ]
                },
            }
        });

        $('div#dapot_bp').unblock();

    });

    $('div#dapot_bp_unit').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPotensiBPUnit.php', function(data){

        var ctx = document.getElementById("chart_dapot_bp_unit");
        ctx.height = 220;
        chart_dapot_bp_unit = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.singkatan,
                datasets: [
                    {
                        label: "NON GE",
                        type: "bar",
                        backgroundColor: "#135470",
                        backgroundColorHover: "#135470",
                        data: data.jml_rpbp_non_ge,
                    },
                    {
                        label: "GE",
                        type: "bar",
                        backgroundColor: "#74BCC7",
                        backgroundColorHover: "#74BCC7",
                        data: data.jml_rpbp_ge,
                    },
                    {
                        label: "TM",
                        type: "bar",
                        backgroundColor: "#F2C36B",
                        backgroundColorHover: "#F2C36B",
                        data: data.jml_rpbp_tm,
                    },
                ]
            },
            options: {
                responsive: true, 
                maintainAspectRatio: false, 
                barRadius: 2,
                title: {
                    display: false,
                    text: 'Rekap Potensi BP'
                },
                tooltips: {
                   mode: 'label',
                   bodyFontSize: 10,
                   callbacks: {
                      label: function(t, d) {
                         var dstLabel = d.datasets[t.datasetIndex].label;
                         var yLabel = t.yLabel;
                         return dstLabel + ': ' + yLabel + ' mVA';
                      }
                   }
                },
                legend: {
                    position: 'bottom',
                    display: true,
                    labels: {
                        fontSize: 10,
                    },
                },
                plugins: {
                    labels: []
                },
                scales: {
                    yAxes: [{
                        display: false,
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                    }]
                }
            }
        });

        $('div#dapot_bp_unit').unblock();

    });

    $('div#overview_daftung .card').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonan.php', function(data){
        $('#total_agenda').html(data.total_agenda);
        $('#total_agenda_rab').html(data.total_agenda_rab);
        $('#total_agenda_non_rab').html(data.total_agenda_non_rab);
        $('#total_proses').html(data.total_proses);
        $('#total_evaluasi').html(data.total_evaluasi);
        $('#total_klasifikasi_rab_1').html(data.total_klasifikasi_rab_1);
        $('#total_klasifikasi_rab_2').html(data.total_klasifikasi_rab_2);
        $('#total_klasifikasi_rab_3').html(data.total_klasifikasi_rab_3);
        $('#total_klasifikasi_rab_4').html(data.total_klasifikasi_rab_4);
        $('#total_klasifikasi_rab_5').html(data.total_klasifikasi_rab_5);
        $('#total_klasifikasi_rab_6').html(data.total_klasifikasi_rab_6);
        $('div#overview_daftung .card').unblock();

    });

    $('div#card_permohonan_jenis').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonanJenis.php', function(data){
        var ctx = document.getElementById("chart_permohonan_jenis");
        ctx.width = 220;
        ctx.height = 220;
        chart_jenis = new Chart(ctx, {
            type: 'pie',
            data: {
                datasets: [{
                    data: data.jml_permohonan,
                    backgroundColor: [
                        '#135470',
                        '#74BCC7',
                        '#F2C36B',
                        '#EC5B43',
                        '#7F63F4',
                        '#3D494A',
                        '#9DA6AB',
                    ],
                    label: 'Jenis Transaksi'
                }],
                labels: data.ket_transaksi
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    arc: {
                        borderWidth: 0
                    }
                },
                legend: {
                    position: 'bottom',
                    display: 0,
                    labels: {
                        // fontFamily: 'CircularStdBook',
                        fontSize: 8,
                    },
                },
                tooltips:{
                    titleFontSize: 8,
                    bodyFontSize: 8,
                    footerFontSize: 8,
                },
                plugins: {
                    labels: [
                        {
                          render: 'label',
                          fontSize: 7,
                          fontColor:  [
                                '#135470',
                                '#74BCC7',
                                '#F2C36B',
                                '#EC5B43',
                                '#7F63F4',
                                '#3D494A',
                                '#9DA6AB',
                            ],
                          precision: 0,
                          position: 'outside',
                          arc: true,
                          textMargin: 2,
                        },
                        {
                          render: 'value',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 1,
                          position: 'border'
                        },
                        {
                          render: 'percentage',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 0,
                          position: 'default'
                        }
                    ]
                },
            }
        });

        $('div#card_permohonan_jenis').unblock();

    });

    $('div#card_permohonan_jenis_unit').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonanJenisUnit.php', function(data){

        var ctx = document.getElementById("chart_permohonan_jenis_unit");
        ctx.height = 220;
        chart_jenis_unit = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.singkatan,
                datasets: [
                    {
                        label: "LAIN-LAIN (SAMBUNG KEMBALI, TURUN DAYA, UBAH TARIF, MIGRASI PASKA)",
                        type: "bar",
                        backgroundColor: "#EC5B43",
                        backgroundColorHover: "#EC5B43",
                        data: data.jml_agenda_jenis_lain,
                    },
                    {
                        label: "MIGRASI KE PRABAYAR",
                        type: "bar",
                        backgroundColor: "#F2C36B",
                        backgroundColorHover: "#F2C36B",
                        data: data.jml_agenda_jenis_migrasi_lpb,
                    },
                    {
                        label: "PASANG BARU",
                        type: "bar",
                        backgroundColor: "#74BCC7",
                        backgroundColorHover: "#74BCC7",
                        data: data.jml_agenda_jenis_pasang_baru,
                    },
                    {
                        label: "TAMBAH DAYA",
                        type: "bar",
                        backgroundColor: "#135470",
                        backgroundColorHover: "#135470",
                        data: data.jml_agenda_jenis_tambah_daya,
                    },
                ]
            },
            options: {
                responsive: true, 
                maintainAspectRatio: false, 
                barRadius: 2,
                title: {
                    display: false,
                    text: 'Rekap Permohonan'
                },
                tooltips: {
                   mode: 'label',
                   bodyFontSize: 10,
                   callbacks: {
                      label: function(t, d) {
                         var dstLabel = d.datasets[t.datasetIndex].label;
                         var yLabel = t.yLabel;
                         return dstLabel + ': ' + yLabel + ' Agenda';
                      }
                   }
                },
                legend: {
                    position: 'bottom',
                    display: true,
                    labels: {
                        fontSize: 10,
                    },
                },
                plugins: {
                    labels: []
                },
                scales: {
                    yAxes: [{
                        display: false,
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                    }]
                }
            }
        });

        $('div#card_permohonan_jenis_unit').unblock();

    });

    $('div#card_permohonan_tmp').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonanTMP.php', function(data){
        var ctx = document.getElementById("chart_permohonan_tmp");

        ctx.width = 220;
        ctx.height = 220;
        chart_tmp = new Chart(ctx, {
            type: 'pie',
            data: {
                datasets: [{
                    data: data.jml_permohonan,
                    backgroundColor: [
                        '#74BCC7',
                        '#F2C36B',
                        '#EC5B43',
                        '#7F63F4',
                        '#3D494A',
                        '#9DA6AB',
                    ],
                    label: 'Status TMP'
                }],
                labels: data.status_tmp
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    arc: {
                        borderWidth: 0
                    }
                },
                legend: {
                    position: 'bottom',
                    display: 0,
                    labels: {
                        // fontFamily: 'CircularStdBook',
                        fontSize: 8,
                    },
                },
                tooltips:{
                    titleFontSize: 8,
                    bodyFontSize: 8,
                    footerFontSize: 8,
                },
                plugins: {
                    labels: [
                        {
                          render: 'label',
                          fontSize: 7,
                          fontColor:  [
                                '#74BCC7',
                                '#F2C36B',
                                '#EC5B43',
                                '#7F63F4',
                                '#3D494A',
                                '#9DA6AB',
                            ],
                          precision: 0,
                          position: 'outside',
                          arc: true,
                          textMargin: 2,
                        },
                        {
                          render: 'value',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 1,
                          position: 'border'
                        },
                        {
                          render: 'percentage',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 0,
                          position: 'default'
                        }
                    ]
                },
            }
        });

        $('div#card_permohonan_tmp').unblock();
    });

    $('div#card_permohonan_tmp_unit').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonanTMPUnit.php', function(data){

        var ctx = document.getElementById("chart_permohonan");
        ctx.height = 220;
        chart_tmp_unit = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.singkatan,
                datasets: [
                   
                    {
                        label: "Melebihi TMP",
                        type: "bar",
                        stack: 'Agenda per Status TMP',
                        backgroundColor: "#EC5B43",
                        backgroundColorHover: "#EC5B43",
                        data: data.jml_agenda_melebihi_tmp,
                    },
                    {
                        label: "Mendekati TMP",
                        type: "bar",
                        stack: 'Agenda per Status TMP',
                        backgroundColor: "#F2C36B",
                        backgroundColorHover: "#F2C36B",
                        data: data.jml_agenda_mendekati_tmp,
                    },
                    {
                        label: "Dalam TMP",
                        type: "bar",
                        stack: 'Agenda per Status TMP',
                        backgroundColor: "#74BCC7",
                        backgroundColorHover: "#74BCC7",
                        data: data.jml_agenda_dalam_tmp,
                    },
                ]
            },
            options: {
                responsive: true, 
                maintainAspectRatio: false, 
                barRadius: 2,
                title: {
                    display: false,
                    text: 'Rekap Permohonan'
                },
                tooltips: {
                   mode: 'label',
                   bodyFontSize: 10,
                   callbacks: {
                      label: function(t, d) {
                         var dstLabel = d.datasets[t.datasetIndex].label;
                         var yLabel = t.yLabel;
                         return dstLabel + ': ' + yLabel + ' Agenda';
                      }
                   }
                },
                legend: {
                    position: 'bottom',
                    display: true,
                    labels: {
                        fontSize: 10,
                    },
                },
                plugins: {
                    labels: []
                },
                scales: {
                    yAxes: [{
                        display: false,
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                    }]
                }
            }
        });

        $('div#card_permohonan_tmp_unit').unblock();

    });

    $('div#card_permohonan_alasan_kriteria').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonanAlasan.php', function(data){
        var ctx = document.getElementById("chart_permohonan_alasan_kriteria");
        ctx.width = 220;
        ctx.height = 220;
        chart_alasan = new Chart(ctx, {
            type: 'pie',
            data: {
                datasets: [{
                    data: data.jml_permohonan,
                    backgroundColor: [
                        '#135470',
                        '#74BCC7',
                        '#F2C36B',
                        '#EC5B43',
                        '#7F63F4',
                        '#3D494A',
                        '#9DA6AB',
                    ],
                    label: 'Alasan Kriteria TMP'
                }],
                labels: data.alasan_kriteria_tmp
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    arc: {
                        borderWidth: 0
                    }
                },
                legend: {
                    position: 'bottom',
                    display: 0,
                    labels: {
                        // fontFamily: 'CircularStdBook',
                        fontSize: 8,
                    },
                },
                tooltips:{
                    titleFontSize: 8,
                    bodyFontSize: 8,
                    footerFontSize: 8,
                    tooltipCaretSize: 0,
                    percentageInnerCutout : 70
                },
                plugins: {
                    labels: [
                        {
                          render: 'label',
                          fontSize: 7,
                          fontColor:   [
                                '#135470',
                                '#74BCC7',
                                '#F2C36B',
                                '#EC5B43',
                                '#7F63F4',
                                '#3D494A',
                                '#9DA6AB',
                            ],
                          precision: 0,
                          position: 'outside',
                          arc: true,
                          textMargin: 2,
                        },
                        {
                          render: 'value',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 1,
                          position: 'border'
                        },
                        {
                          render: 'percentage',
                          fontSize: 9,
                          fontColor: 'white',
                          precision: 0,
                          position: 'default'
                        }
                    ]
                },
            }
        });

        $('div#card_permohonan_alasan_kriteria').unblock();

    });

    $('div#card_permohonan_alasan_kriteria_unit').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonanAlasanUnit.php', function(data){

        var ctx = document.getElementById("chart_permohonan_alasan_kriteria_unit");
        ctx.height = 220;
        chart_alasan_unit = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.singkatan,
                datasets: [
                    {
                        label: "LAIN-LAIN",
                        type: "bar",
                        backgroundColor: "#EC5B43",
                        backgroundColorHover: "#EC5B43",
                        data: data.jml_agenda_alasan_lain,
                    },
                    {
                        label: "PERLU PEMBANGUNAN JTM S.D 3 GAWANG & TRAFO DISTRIBUSI",
                        type: "bar",
                        backgroundColor: "#F2C36B",
                        backgroundColorHover: "#F2C36B",
                        data: data.jml_agenda_alasan_perluasan_jtm,
                    },
                    {
                        label: "PERLU PERLUASAN JTR",
                        type: "bar",
                        backgroundColor: "#74BCC7",
                        backgroundColorHover: "#74BCC7",
                        data: data.jml_agenda_alasan_perluasan_jtr,
                    },
                    {
                        label: "TANPA PERLUASAN",
                        type: "bar",
                        backgroundColor: "#135470",
                        backgroundColorHover: "#135470",
                        data: data.jml_agenda_alasan_tanpa_perluasan,
                    },
                ]
            },
            options: {
                responsive: true, 
                maintainAspectRatio: false, 
                barRadius: 2,
                title: {
                    display: false,
                    text: 'Rekap Permohonan'
                },
                tooltips: {
                   mode: 'label',
                   bodyFontSize: 10,
                   callbacks: {
                      label: function(t, d) {
                         var dstLabel = d.datasets[t.datasetIndex].label;
                         var yLabel = t.yLabel;
                         return dstLabel + ': ' + yLabel + ' Agenda';
                      }
                   }
                },
                legend: {
                    position: 'bottom',
                    display: true,
                    labels: {
                        fontSize: 10,
                    },
                },
                plugins: {
                    labels: []
                },
                scales: {
                    yAxes: [{
                        display: false,
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        stacked: true,
                        gridLines: {
                            display: false,
                            drawBorder: false
                        },
                    }]
                }
            }
        });

        $('div#card_permohonan_alasan_kriteria_unit').unblock();

    });

    $('div#card_latest_agenda table tbody').empty();
    $('div#card_latest_agenda').block({ message: 'Mengambil data...' });
    $.getJSON('../controller/getDashboardPermohonanTerlama.php', function(data){

        var tr = '';
        $.each(data.rows, function(k,v){
            tr += '<tr>';
            tr += '<td><a href="info-agenda.php?noagenda='+v.noagenda+'" target="_blank">'+v.noagenda+'</a></td>';
            tr += '<td>'+v.tglmohon+'</td>';
            tr += '<td>'+v.jenis_transaksi+'</td>';
            tr += '<td>'+v.tarif_daya_lama+'</td>';
            tr += '<td>'+v.tarif_daya_baru+'</td>';
            // tr += '<td>'+v.alasan_kriteria_tmp+'</td>';
            tr += '<td>'+v.rp_bp+'</td>';
            tr += '<td>'+v.rp_rab+'</td>';
            tr += '<td><span class="label '+v.label_status+'">'+v.status+'</span></td>';
            tr += '</tr>';
        });
        $('div#card_latest_agenda table tbody').append(tr);
        $('div#card_latest_agenda').unblock();
    });

    $('#sel_unit').change(function(){
        var unitap=this.value;


        $('div#pasang_baru').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensiJenisTransaksi.php?jenis_transaksi=pasang baru&unitap='+unitap, function(data){
            $('#dapot_jenis_transaksi #pasang_baru #jml_agenda').html(data.jml_agenda);
            $('#dapot_jenis_transaksi #pasang_baru #jml_daya').html(data.jml_daya);
            $('#dapot_jenis_transaksi #pasang_baru #jml_rpbp').html(data.jml_rpbp);
            $('#dapot_jenis_transaksi #pasang_baru #jml_rpujl').html(data.jml_rpujl);
            $('div#pasang_baru').unblock();
        });
        $('div#perubahan_daya').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensiJenisTransaksi.php?jenis_transaksi=perubahan daya&unitap='+unitap, function(data){
            $('#dapot_jenis_transaksi #perubahan_daya #jml_agenda').html(data.jml_agenda);
            $('#dapot_jenis_transaksi #perubahan_daya #jml_daya').html(data.jml_daya);
            $('#dapot_jenis_transaksi #perubahan_daya #jml_rpbp').html(data.jml_rpbp);
            $('#dapot_jenis_transaksi #perubahan_daya #jml_rpujl').html(data.jml_rpujl);
            $('div#perubahan_daya').unblock();
        });
        $('div#sambung_kembali').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensiJenisTransaksi.php?jenis_transaksi=sambung kembali&unitap='+unitap, function(data){
            $('#dapot_jenis_transaksi #sambung_kembali #jml_agenda').html(data.jml_agenda);
            $('#dapot_jenis_transaksi #sambung_kembali #jml_daya').html(data.jml_daya);
            $('#dapot_jenis_transaksi #sambung_kembali #jml_rpbp').html(data.jml_rpbp);
            $('#dapot_jenis_transaksi #sambung_kembali #jml_rpujl').html(data.jml_rpujl);
            $('div#sambung_kembali').unblock();
        });

        $('div#non_ge').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensi.php?klp_plg=NON_GE&unitap='+unitap, function(data){
            $('#dapot #non_ge #jml_agenda').html(data.jml_agenda);
            $('#dapot #non_ge #jml_daya').html(data.jml_daya);
            $('#dapot #non_ge #jml_rpbp').html(data.jml_rpbp);
            $('#dapot #non_ge #jml_rpujl').html(data.jml_rpujl);
            $('div#non_ge').unblock();
        });
        $('div#ge').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensi.php?klp_plg=GE&unitap='+unitap, function(data){
            $('#dapot #ge #jml_agenda').html(data.jml_agenda);
            $('#dapot #ge #jml_daya').html(data.jml_daya);
            $('#dapot #ge #jml_rpbp').html(data.jml_rpbp);
            $('#dapot #ge #jml_rpujl').html(data.jml_rpujl);
            $('div#ge').unblock();
        });
        $('div#tm').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensi.php?klp_plg=TM&unitap='+unitap, function(data){
            $('#dapot #tm #jml_agenda').html(data.jml_agenda);
            $('#dapot #tm #jml_daya').html(data.jml_daya);
            $('#dapot #tm #jml_rpbp').html(data.jml_rpbp);
            $('#dapot #tm #jml_rpujl').html(data.jml_rpujl);
            $('div#tm').unblock();
        });

        $('div#dapot_daya').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensiDaya.php?unitap='+unitap, function(data){
            
            chart_dapot_daya.data.datasets[0].data = data.jml_daya;
            chart_dapot_daya.data.labels = data.klp_plg;
            chart_dapot_daya.update();
            $('div#dapot_daya').unblock();

        });

        $('div#dapot_daya_unit').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensiDayaUnit.php?unitap='+unitap, function(data){
            
            chart_dapot_daya_unit.data.datasets[0].data = data.jml_daya_non_ge;
            chart_dapot_daya_unit.data.datasets[1].data = data.jml_daya_ge;
            chart_dapot_daya_unit.data.datasets[2].data = data.jml_daya_tm;
            chart_dapot_daya_unit.data.labels = data.singkatan;
            chart_dapot_daya_unit.update();
            $('div#dapot_daya_unit').unblock();

        });

        $('div#dapot_bp').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensiBP.php?unitap='+unitap, function(data){
            
            chart_dapot_bp.data.datasets[0].data = data.jml_rpbp;
            chart_dapot_bp.data.labels = data.klp_plg;
            chart_dapot_bp.update();
            $('div#dapot_bp').unblock();

        });

        $('div#dapot_bp_unit').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPotensiBPUnit.php?unitap='+unitap, function(data){

            chart_dapot_bp_unit.data.datasets[0].data = data.jml_rpbp_non_ge;
            chart_dapot_bp_unit.data.datasets[1].data = data.jml_rpbp_ge;
            chart_dapot_bp_unit.data.datasets[2].data = data.jml_rpbp_tm;
            chart_dapot_bp_unit.data.labels = data.singkatan;
            chart_dapot_bp_unit.update();
            $('div#dapot_bp_unit').unblock();

        });

        $('div#overview_daftung .card').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonan.php?unitap='+unitap, function(data){
            $('#total_agenda').html(data.total_agenda);
            $('#total_agenda_rab').html(data.total_agenda_rab);
            $('#total_agenda_non_rab').html(data.total_agenda_non_rab);
            $('#total_proses').html(data.total_proses);
            $('#total_evaluasi').html(data.total_evaluasi);
            $('#total_klasifikasi_rab_1').html(data.total_klasifikasi_rab_1);
            $('#total_klasifikasi_rab_2').html(data.total_klasifikasi_rab_2);
            $('#total_klasifikasi_rab_3').html(data.total_klasifikasi_rab_3);
            $('#total_klasifikasi_rab_4').html(data.total_klasifikasi_rab_4);
            $('#total_klasifikasi_rab_5').html(data.total_klasifikasi_rab_5);
            $('#total_klasifikasi_rab_6').html(data.total_klasifikasi_rab_6);
            $('div#overview_daftung .card').unblock();

        });

        $('div#card_permohonan_jenis').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonanJenis.php?unitap='+unitap, function(data){

            chart_jenis.data.datasets[0].data = data.jml_permohonan;
            chart_jenis.data.labels = data.ket_transaksi;
            chart_jenis.update();
            $('div#card_permohonan_jenis').unblock();

        });

        $('div#card_permohonan_jenis_unit').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonanJenisUnit.php?unitap='+unitap, function(data){

            chart_jenis_unit.data.datasets[0].data = data.jml_agenda_jenis_lain;
            chart_jenis_unit.data.datasets[1].data = data.jml_agenda_jenis_migrasi_lpb;
            chart_jenis_unit.data.datasets[2].data = data.jml_agenda_jenis_pasang_baru;
            chart_jenis_unit.data.datasets[3].data = data.jml_agenda_jenis_tambah_daya;
            chart_jenis_unit.data.labels = data.singkatan;
            chart_jenis_unit.update();
            $('div#card_permohonan_jenis_unit').unblock();

        });

        $('div#card_permohonan_tmp').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonanTMP.php?unitap='+unitap, function(data){

            chart_tmp.data.datasets[0].data = data.jml_permohonan;
            chart_tmp.data.labels = data.status_tmp;
            chart_tmp.update();
            $('div#card_permohonan_tmp').unblock();

        });

        $('div#card_permohonan_tmp_unit').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonanTMPUnit.php?unitap='+unitap, function(data){

            chart_tmp_unit.data.datasets[0].data = data.jml_agenda_melebihi_tmp;
            chart_tmp_unit.data.datasets[1].data = data.jml_agenda_mendekati_tmp;
            chart_tmp_unit.data.datasets[2].data = data.jml_agenda_dalam_tmp;
            chart_tmp_unit.data.labels = data.singkatan;
            chart_tmp_unit.update();
            $('div#card_permohonan_tmp_unit').unblock();

        });

        $('div#card_permohonan_alasan_kriteria').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonanAlasan.php?unitap='+unitap, function(data){

            chart_alasan.data.datasets[0].data = data.jml_permohonan;
            chart_alasan.data.labels = data.alasan_kriteria_tmp;
            chart_alasan.update();
            $('div#card_permohonan_alasan_kriteria').unblock();

        });

        $('div#card_permohonan_alasan_kriteria_unit').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonanAlasanUnit.php?unitap='+unitap, function(data){

            chart_alasan_unit.data.datasets[0].data = data.jml_agenda_alasan_lain;
            chart_alasan_unit.data.datasets[1].data = data.jml_agenda_alasan_perluasan_jtm;
            chart_alasan_unit.data.datasets[2].data = data.jml_agenda_alasan_perluasan_jtr;
            chart_alasan_unit.data.datasets[3].data = data.jml_agenda_alasan_tanpa_perluasan;
            chart_alasan_unit.data.labels = data.singkatan;
            chart_alasan_unit.update();
            $('div#card_permohonan_alasan_kriteria_unit').unblock();

        });

        $('div#card_latest_agenda table tbody').empty();
        $('div#card_latest_agenda').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/getDashboardPermohonanTerlama.php?unitap='+unitap, function(data){

            var tr = '';
            $.each(data.rows, function(k,v){
                tr += '<tr>';
                tr += '<td><a href="info-agenda.php?noagenda='+v.noagenda+'" target="_blank">'+v.noagenda+'</a></td>';
                tr += '<td>'+v.tglmohon+'</td>';
                tr += '<td>'+v.jenis_transaksi+'</td>';
                tr += '<td>'+v.tarif_daya_lama+'</td>';
                tr += '<td>'+v.tarif_daya_baru+'</td>';
                // tr += '<td>'+v.alasan_kriteria_tmp+'</td>';
                tr += '<td>'+v.rp_bp+'</td>';
                tr += '<td>'+v.rp_rab+'</td>';
                tr += '<td><span class="label '+v.label_status+'">'+v.status+'</span></td>';
                tr += '</tr>';
            });
            $('div#card_latest_agenda table tbody').append(tr);
            $('div#card_latest_agenda').unblock();
        });


        // // Update Bar Chart per Unit
        // $('div#card_permohonan').block({ message: 'Mengambil data...' });
        // $('div#card_permohonan_tmp').block({ message: 'Mengambil data...' });
        // $('div#card_permohonan_status_proses').block({ message: 'Mengambil data...' });
        // $('div#card_permohonan_alasan').block({ message: 'Mengambil data...' });
        // $('div#card_permohonan_jenis').block({ message: 'Mengambil data...' });
        // $('div#card_latest_agenda').block({ message: 'Mengambil data...' });
        // $('div#card_latest_agenda table tbody').empty();

        // $.getJSON('../controller/getDashboardPermohonan.php?unitap='+unitap, function(data){
        //     $('div#card_permohonan').unblock();
        //     $('#total_agenda').html(data.total_agenda);
        //     $('#total_agenda_rab').html(data.total_agenda_rab);
        //     $('#total_proses').html(data.total_proses);
        //     $('#total_evaluasi').html(data.total_evaluasi);
        //     $('#total_klasifikasi_rab_1').html(data.total_klasifikasi_rab_1);
        //     $('#total_klasifikasi_rab_2').html(data.total_klasifikasi_rab_2);
        //     $('#total_klasifikasi_rab_3').html(data.total_klasifikasi_rab_3);
        //     $('#total_klasifikasi_rab_4').html(data.total_klasifikasi_rab_4);
        //     $('#total_klasifikasi_rab_5').html(data.total_klasifikasi_rab_5);
        //     $('#total_klasifikasi_rab_6').html(data.total_klasifikasi_rab_6);
        //     chart_jenis_unit.data.labels = data.singkatan;
        //     chart_jenis_unit.data.datasets[0].data = data.jml_klasifikasi_rab_1;
        //     chart_jenis_unit.data.datasets[1].data = data.jml_klasifikasi_rab_2;
        //     chart_jenis_unit.data.datasets[2].data = data.jml_klasifikasi_rab_3;
        //     chart_jenis_unit.data.datasets[3].data = data.jml_klasifikasi_rab_4;
        //     chart_jenis_unit.data.datasets[4].data = data.jml_klasifikasi_rab_5;
        //     chart_jenis_unit.data.datasets[5].data = data.jml_klasifikasi_rab_6;
        //     chart_jenis_unit.data.datasets[6].data = data.jml_klasifikasi_rab_7;
        //     chart_jenis_unit.data.datasets[7].data = data.jml_agenda_dalam_tmp;
        //     chart_jenis_unit.data.datasets[8].data = data.jml_agenda_mendekati_tmp;
        //     chart_jenis_unit.data.datasets[9].data = data.jml_agenda_melebihi_tmp;
        //     chart_jenis_unit.update();

        //     $.getJSON('../controller/getDashboardPermohonanTMP.php?unitap='+unitap, function(data){
        //         $('div#card_permohonan_tmp').unblock();
        //         chart_tmp.data.datasets[0].data = data.jml_permohonan;
        //         chart_tmp.data.labels = data.status_tmp;
        //         chart_tmp.update();

        //         $.getJSON('../controller/getDashboardPermohonanStatusProses.php?unitap='+unitap, function(data){
        //             $('div#card_permohonan_status_proses').unblock();
        //             chart_status_proses.data.datasets[0].data = data.jml_permohonan;
        //             chart_status_proses.data.labels = data.status_proses;
        //             chart_status_proses.update();

        //             $.getJSON('../controller/getDashboardPermohonanAlasan.php?unitap='+unitap, function(data){
        //                 $('div#card_permohonan_alasan').unblock();
        //                 chart_alasan.data.datasets[0].data = data.jml_permohonan;
        //                 chart_alasan.data.labels = data.alasan_kriteria_tmp;
        //                 chart_alasan.update();

        //                 $.getJSON('../controller/getDashboardPermohonanJenis.php?unitap='+unitap, function(data){
        //                     $('div#card_permohonan_jenis').unblock();
        //                     chart_jenis.data.datasets[0].data = data.jml_permohonan;
        //                     chart_jenis.data.labels = data.ket_transaksi;
        //                     chart_jenis.update();

        //                     $.getJSON('../controller/getDashboardPermohonanTerlama.php?unitap='+unitap, function(data){
        //                         var tr = '';
        //                         $.each(data.rows, function(k,v){
        //                             tr += '<tr>';
        //                             tr += '<td><a href="info-agenda.php?noagenda='+v.noagenda+'" target="_blank">'+v.noagenda+'</a></td>';
        //                             tr += '<td>'+v.tglmohon+'</td>';
        //                             tr += '<td>'+v.jenis_transaksi+'</td>';
        //                             tr += '<td>'+v.tarif_daya_lama+'</td>';
        //                             tr += '<td>'+v.tarif_daya_baru+'</td>';
        //                             // tr += '<td>'+v.alasan_kriteria_tmp+'</td>';
        //                             tr += '<td>'+v.rp_bp+'</td>';
        //                             tr += '<td>'+v.rp_rab+'</td>';
        //                             tr += '<td><span class="label '+v.label_status+'">'+v.status+'</span></td>';
        //                             tr += '</tr>';
        //                         });
        //                         $('div#card_latest_agenda table tbody').append(tr);
        //                         $('div#card_latest_agenda').unblock();
        //                     });
        //                 });
        //             });
        //         });
        //     });
        // });
    });

    // draw background
    var backgroundColor = 'white';
    Chart.plugins.register({
        beforeDraw: function(c) {
            var ctx = c.chart.ctx;
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(0, 0, c.chart.width, c.chart.height);
        }
    });

    $(".btn-download").click(function(){
        console.log('download');
        var canvas = $(this).closest( ".card" ).children('.card-body').children('canvas');

        canvas.get(0).toBlob(function(blob) {
            saveAs(blob, "Chart.png");
        });
    });

});