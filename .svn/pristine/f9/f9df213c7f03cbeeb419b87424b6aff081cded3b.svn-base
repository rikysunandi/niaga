$(function() {
    "use strict";

    var chart_unit, chart_akhir_unit, chart_akhir_tetap_unit, chart_blocking, chart_segmen_tegangan, chart_alasan, chart_ket_transaksi;

    $('#sel_unit').selectpicker('val', '00');
        // Parsing miss-matches and typo's
    var Format = wNumb({
        thousand: ',',
        decimals: 0
    });
    var Format1d = wNumb({
        thousand: ',',
        decimals: 1
    });

    function loadDataDashboard(unitap){

        $('div.saldo-awal').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getSaldoAwal.php?unitap='+unitap, function(data){
            data = data.data;
            //console.log(data);

            var ctx = document.getElementById("chart_saldo_awal");
            new Chart(ctx, {
                type: 'pie',
                data: {
                    datasets: [{
                        data: [
                                data.hijau_rpts_miliyar, 
                                data.kuning_rpts_miliyar, 
                                data.merah_rpts_miliyar
                        ],
                        backgroundColor: [
                            '#4caf50',
                            '#ffc107',
                            '#ff5722',
                        ],
                        borderWidth: 1,
                        label: 'Kategori'
                    }],
                    labels: ['Hijau','Kuning','Merah']
                },
                options: {
                    responsive: true,
                    legend: {
                        display: false,
                    },
                    plugins: {
                        labels: [
                            {
                              render: 'percentage',
                              fontSize: 9,
                              fontColor: 'white',
                              precision: 1
                            }
                        ],
                    },
                }
            });

            $('div.saldo-awal tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('div.saldo-awal tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('div.saldo-awal tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('div.saldo-awal tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('div.saldo-awal tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('div.saldo-awal tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('div.saldo-awal tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('div.saldo-awal tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('div.saldo-awal tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('div.saldo-awal tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('div.saldo-awal tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('div.saldo-awal tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            
            $('div.saldo-awal').unblock();

        });

        $('div.realisasi').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getRealisasi.php?unitap='+unitap, function(data){
            data = data.data;
            //console.log(data);

            var ctx = document.getElementById("chart_realisasi");
            new Chart(ctx, {
                type: 'pie',
                data: {
                    datasets: [{
                        data: [
                                data.hijau_rpts_miliyar, 
                                data.kuning_rpts_miliyar, 
                                data.merah_rpts_miliyar
                        ],
                        backgroundColor: [
                            '#4caf50',
                            '#ffc107',
                            '#ff5722',
                        ],
                        borderWidth: 1,
                        label: 'Kategori'
                    }],
                    labels: ['Hijau','Kuning','Merah']
                },
                options: {
                    responsive: true,
                    legend: {
                        display: false,
                    },
                    plugins: {
                        labels: [
                            {
                              render: 'percentage',
                              fontSize: 9,
                              fontColor: 'white',
                              precision: 1
                            }
                        ]
                    },
                }
            });

            $('div.realisasi tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('div.realisasi tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('div.realisasi tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('div.realisasi tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('div.realisasi tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('div.realisasi tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('div.realisasi tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('div.realisasi tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('div.realisasi tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('div.realisasi tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('div.realisasi tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('div.realisasi tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('div.realisasi').unblock();

        });

        $('div.saldo-akhir').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getSaldoAkhir.php?unitap='+unitap, function(data){
            data = data.data;
            //console.log(data);

            var ctx = document.getElementById("chart_saldo_akhir");
            new Chart(ctx, {
                type: 'pie',
                data: {
                    datasets: [{
                        data: [
                                data.hijau_rpts_miliyar, 
                                data.kuning_rpts_miliyar, 
                                data.merah_rpts_miliyar
                        ],
                        backgroundColor: [
                            '#4caf50',
                            '#ffc107',
                            '#ff5722',
                        ],
                        borderWidth: 1,
                        label: 'Kategori'
                    }],
                    labels: ['Hijau','Kuning','Merah']
                },
                options: {
                    responsive: true,
                    legend: {
                        display: false,
                    },
                    plugins: {
                        labels: [
                            {
                              render: 'percentage',
                              fontSize: 9,
                              fontColor: 'white',
                              precision: 1
                            }
                        ]
                    },
                }
            });

            $('div.saldo-akhir tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('div.saldo-akhir tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('div.saldo-akhir tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('div.saldo-akhir tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('div.saldo-akhir tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('div.saldo-akhir tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('div.saldo-akhir tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('div.saldo-akhir tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('div.saldo-akhir tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('div.saldo-akhir tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('div.saldo-akhir tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('div.saldo-akhir tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('div.saldo-akhir').unblock();

        });

        $('article.histori-saldo-awal div.timeline-label').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTS.php?unitap='+unitap+'&tgl_kategori=2021-02-18&tgl_saldo=2021-02-18', function(data){
            data = data.data;
            //console.log(data);
            $('article.histori-saldo-awal tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('article.histori-saldo-awal tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('article.histori-saldo-awal tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-awal tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('article.histori-saldo-awal tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('article.histori-saldo-awal tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-awal tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('article.histori-saldo-awal tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('article.histori-saldo-awal tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('article.histori-saldo-awal tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('article.histori-saldo-awal tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('article.histori-saldo-awal tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-awal div.timeline-label').unblock();

        });

        $('article.histori-saldo-1 div.timeline-label').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTS.php?unitap='+unitap+'&tgl_kategori=2021-02-18&tgl_saldo=2021-02-25', function(data){
            data = data.data;
            //console.log(data);
            $('article.histori-saldo-1 tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('article.histori-saldo-1 tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('article.histori-saldo-1 tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-1 tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('article.histori-saldo-1 tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('article.histori-saldo-1 tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-1 tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('article.histori-saldo-1 tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('article.histori-saldo-1 tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('article.histori-saldo-1 tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('article.histori-saldo-1 tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('article.histori-saldo-1 tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-1 div.timeline-label').unblock();

        });

        $('article.histori-saldo-2 div.timeline-label').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTS.php?unitap='+unitap+'&tgl_kategori=2021-02-25&tgl_saldo=2021-02-25', function(data){
            data = data.data;
            //console.log(data);
            $('article.histori-saldo-2 tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('article.histori-saldo-2 tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('article.histori-saldo-2 tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-2 tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('article.histori-saldo-2 tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('article.histori-saldo-2 tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-2 tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('article.histori-saldo-2 tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('article.histori-saldo-2 tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('article.histori-saldo-2 tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('article.histori-saldo-2 tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('article.histori-saldo-2 tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-2 div.timeline-label').unblock();

        });


        $('article.histori-saldo-3 div.timeline-label').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTS.php?unitap='+unitap+'&tgl_kategori=2021-02-25&tgl_saldo=2021-03-04', function(data){
            data = data.data;
            //console.log(data);
            $('article.histori-saldo-3 tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('article.histori-saldo-3 tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('article.histori-saldo-3 tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-3 tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('article.histori-saldo-3 tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('article.histori-saldo-3 tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-3 tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('article.histori-saldo-3 tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('article.histori-saldo-3 tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('article.histori-saldo-3 tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('article.histori-saldo-3 tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('article.histori-saldo-3 tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-3 div.timeline-label').unblock();

        });

        $('article.histori-saldo-4 div.timeline-label').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTS.php?unitap='+unitap+'&tgl_kategori=2021-03-04&tgl_saldo=2021-03-04', function(data){
            data = data.data;
            //console.log(data);
            $('article.histori-saldo-4 tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('article.histori-saldo-4 tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('article.histori-saldo-4 tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-4 tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('article.histori-saldo-4 tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('article.histori-saldo-4 tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-4 tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('article.histori-saldo-4 tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('article.histori-saldo-4 tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('article.histori-saldo-4 tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('article.histori-saldo-4 tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('article.histori-saldo-4 tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-4 div.timeline-label').unblock();

        });

        $('article.histori-saldo-5 div.timeline-label').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTS.php?unitap='+unitap+'&tgl_kategori=2021-03-04&tgl_saldo=2021-03-18', function(data){
            data = data.data;
            //console.log(data);
            $('article.histori-saldo-5 tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('article.histori-saldo-5 tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('article.histori-saldo-5 tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-5 tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('article.histori-saldo-5 tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('article.histori-saldo-5 tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-5 tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('article.histori-saldo-5 tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('article.histori-saldo-5 tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('article.histori-saldo-5 tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('article.histori-saldo-5 tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('article.histori-saldo-5 tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-5 div.timeline-label').unblock();

        });

        $('article.histori-saldo-6 div.timeline-label').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTS.php?unitap='+unitap+'&tgl_kategori=2021-03-18&tgl_saldo=2021-03-18', function(data){
            data = data.data;
            //console.log(data);
            $('article.histori-saldo-6 tr.hijau td.jml-plg').html(Format.to(data.hijau_jml_plg));
            $('article.histori-saldo-6 tr.hijau td.jml-agenda').html(Format.to(data.hijau_jml_agenda));
            $('article.histori-saldo-6 tr.hijau td.rpts_miliyar').html(Format1d.to(data.hijau_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-6 tr.kuning td.jml-plg').html(Format.to(data.kuning_jml_plg));
            $('article.histori-saldo-6 tr.kuning td.jml-agenda').html(Format.to(data.kuning_jml_agenda));
            $('article.histori-saldo-6 tr.kuning td.rpts_miliyar').html(Format1d.to(data.kuning_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-6 tr.merah td.jml-plg').html(Format.to(data.merah_jml_plg));
            $('article.histori-saldo-6 tr.merah td.jml-agenda').html(Format.to(data.merah_jml_agenda));
            $('article.histori-saldo-6 tr.merah td.rpts_miliyar').html(Format1d.to(data.merah_rpts_miliyar)+'<small> M</small>');
            //$('article.histori-saldo-6 tr.total span.jml-plg').html(Format.to(data.total_jml_plg));
            $('article.histori-saldo-6 tr.total span.jml-agenda').html(Format.to(data.total_jml_agenda));
            $('article.histori-saldo-6 tr.total span.rpts_miliyar').html(Format1d.to(data.total_rpts_miliyar)+'<small> M</small>');
            $('article.histori-saldo-6 div.timeline-label').unblock();

        });

        $('div#card_ts_p2tl').block({ message: 'Mengambil data...' });
        $.getJSON('../controller/ts_p2tl/getHistoriSaldoTSUnit.php?unitap='+unitap, function(data){

            var tr = '';
            $.each(data.rows, function(k,v){
                tr += '<tr>';
                tr += '<td>'+v.kode+'</td>';
                tr += '<td>'+v.nama+'</td>';
                tr += '<td class="text-right">'+Format.to(v.jml_plg)+'</td>';
                tr += '<td class="text-right">'+Format.to(v.jml_agenda)+'</td>';
                tr += '<td class="text-right">'+Format.to(v.rpts)+'</td>';
                tr += '</tr>';
            });
            $('div#card_ts_p2tl table tbody').append(tr);

            tr = '<tr>';
            tr += '<td colspan="2">TOTAL</td>';
            tr += '<td class="text-right">'+Format.to(data.data.total_jml_plg)+'</td>';
            tr += '<td class="text-right">'+Format.to(data.data.total_jml_agenda)+'</td>';
            tr += '<td class="text-right">'+Format.to(data.data.total_rpts)+'</td>';
            tr += '</tr>';
            $('div#card_ts_p2tl table tfoot').append(tr);

            data = data.data;
            console.log(data);
        
            var ctx = document.getElementById("chart_ts_p2tl_unit");
            ctx.height = 240;
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.singkatan,
                    datasets: [
                        {
                            label: "Hijau",
                            type: "bar",
                            stack: 'Kategori',
                            backgroundColor: "#4caf50",
                            backgroundColorHover: "#4caf50",
                            data: data.hijau_rpts_miliyar_unit,
                        },
                        {
                            label: "Kuning",
                            type: "bar",
                            stack: 'Kategori',
                            backgroundColor: "#ffc107",
                            backgroundColorHover: "#ffc107",
                            data: data.kuning_rpts_miliyar_unit,
                        },
                        {
                            label: "Merah",
                            type: "bar",
                            stack: 'Kategori',
                            backgroundColor: "#ff5722",
                            backgroundColorHover: "#ff5722",
                            data: data.merah_rpts_miliyar_unit,
                        },
                    ]
                },
                options: {
                    responsive: true, 
                    maintainAspectRatio: false, 
                    barRadius: 2,
                    title: {
                        display: false,
                        text: 'Rekap Saldo TS P2TL'
                    },
                    tooltips: {
                       mode: 'label',
                       bodyFontSize: 10,
                       callbacks: {
                          label: function(t, d) {
                             var dstLabel = d.datasets[t.datasetIndex].label;
                             var yLabel = t.yLabel;
                             return dstLabel + ': Rp. ' + yLabel + ' M';
                          }
                       }
                    },
                    legend: {
                        position: 'bottom',
                        display: false,
                        labels: {
                            fontSize: 10,
                        },
                    },
                    plugins: {
                        labels: []
                    },
                    scales: {
                        yAxes: [{
                            display: false,
                            stacked: true,
                            gridLines: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            stacked: true,
                            gridLines: {
                                display: false,
                                drawBorder: false
                            },
                        }]
                    }
                }
            });

            $('div#card_ts_p2tl').unblock();
        });
    }

    loadDataDashboard('00');

    $('#sel_unit').change(function(){
        var unitap=this.value;

        loadDataDashboard(unitap);
    });

    // draw background
    var backgroundColor = 'white';
    Chart.plugins.register({
        beforeDraw: function(c) {
            var ctx = c.chart.ctx;
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(0, 0, c.chart.width, c.chart.height);
        }
    });

    $(".btn-download").click(function(){
        console.log('download');
        var canvas = $(this).closest( ".card" ).children('.card-body').children('canvas');

        canvas.get(0).toBlob(function(blob) {
            saveAs(blob, "Chart.png");
        });
    });

});